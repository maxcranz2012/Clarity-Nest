<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouse (Clicker)</title>
    <link rel="shortcut icon" href="mish-Photoroom.png">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #131313;
            font-family: Arial, sans-serif;
            color: #fff;
        }

        .intro-screen, .game-screen, .end-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            width: 100%;
            height: 100%;
        }

        .story-text {
            font-size: 24px;
            margin: 20px;
            opacity: 0;
            animation: fadeIn 2s forwards;
        }

        .hidden {
            display: none;
        }

        .top-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .click-count {
            font-size: 24px;
            font-weight: bold;
        }

        .main-mouse {
            width: 200px;
            margin: 20px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .main-mouse:active {
            transform: translateY(-10px);
        }

        .buttons {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        button {
            padding: 10px 20px;
            margin-top: 20px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #0056b3;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes explode {
            0% { opacity: 1; transform: scale(1) translate(0, 0); }
            100% { opacity: 0; transform: scale(2) translate(100px, -100px); }
        }

        .exploding {
            position: relative;
            animation: explode 1s forwards ease-out;
        }
        #endButton {
            background-color: gold;
            color: black;
        }
    </style>
</head>
<body>
    <div id="introScreen" class="intro-screen hidden">
        <div id="storyText" class="story-text"></div>
    </div>
    <div id="gameScreen" class="game-screen hidden">
        <div class="top-bar">
            <span id="clickCount" class="click-count">0</span> / 10000
        </div>
        <img id="mouseImage" src="mish-Photoroom.png" alt="Mouse" class="main-mouse" onclick="incrementClicks()">
        <div class="buttons">
            <button onclick="showStory()">Story</button>
            <button onclick="confirmResetGame()" style="background-color: red;">New Game</button>
            <button id="endButton" class="hidden" onclick="triggerEnding()">Ending</button> <!-- New button -->
        </div>
    </div>
    <div id="endScreen" class="end-screen hidden">
        <h1 id="endText">Mouse is freed!</h1>
        <img id="explodingMouse" src="mish-Photoroom.png" alt="Mouse" class="main-mouse hidden">
        <div class="buttons">
            <button onclick="freeMode()" style="background-color: rgb(0, 201, 0);">Free Mode</button>
            <button onclick="confirmResetGame()" style="background-color: red;">New Game</button>
            <button id="shareButton">Share Result</button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script>
        let clickCount = 0;
        let freeModeActive = false; // Flag to track free mode activation
        const storyTexts = [
            "A human locked the mouse in a cage...",
            "The lord of the animals saw this and ordered the poacher to release it.",
            "The poacher got scared and tried, but the cage was so strong that he couldn't break it.",
            "Now he must hit it 10,000 times to break it, or else it will be very bad...",
        ];
        let currentStoryIndex = 0;
        let gameStarted = localStorage.getItem('gameStarted') === 'true';
        let storyCompleted = localStorage.getItem('storyCompleted') === 'true';

        document.addEventListener("DOMContentLoaded", () => {
            if (!gameStarted || !storyCompleted) {
                document.getElementById("introScreen").classList.remove("hidden");
                showNextStory();
            } else {
                document.getElementById("gameScreen").classList.remove("hidden");
                clickCount = parseInt(localStorage.getItem('clickCount')) || 0;
                document.getElementById("clickCount").textContent = clickCount;
            }
        });

        document.addEventListener("click", () => {
            if (!storyCompleted) {
                showNextStory();
            }
        });

        function showNextStory() {
            if (currentStoryIndex < storyTexts.length) {
                const storyTextElement = document.getElementById("storyText");
                storyTextElement.textContent = storyTexts[currentStoryIndex];
                currentStoryIndex++;
            } else {
                storyCompleted = true;
                localStorage.setItem('storyCompleted', 'true');
                startGame();
            }
        }

        function startGame() {
            document.getElementById("introScreen").classList.add("hidden");
            document.getElementById("gameScreen").classList.remove("hidden");
            localStorage.setItem('gameStarted', 'true');
        }

        function incrementClicks() {
            clickCount++;
            document.getElementById("clickCount").textContent = clickCount;
            localStorage.setItem('clickCount', clickCount);

            if (!freeModeActive && clickCount >= 10000) {
                endGame();
            }
        }

        function endGame() {
            document.getElementById("gameScreen").classList.add("hidden");
            document.getElementById("endScreen").classList.remove("hidden");
            triggerExplosion();
        }

        function triggerExplosion() {
            const mouseImage = document.getElementById("explodingMouse");
            mouseImage.classList.remove("hidden");
            mouseImage.classList.add("exploding");
            setTimeout(() => {
                mouseImage.classList.add("hidden");
            }, 1000);
        }

        function freeMode() {
            freeModeActive = true; // Activate free mode
            document.getElementById("endScreen").classList.add("hidden");
            document.getElementById("gameScreen").classList.remove("hidden");

            // Show "Ending" button
            document.getElementById("endButton").classList.remove("hidden");
        }

        function triggerEnding() {
            endGame(); // Show ending
        }

        function confirmResetGame() {
            if (confirm("Are you sure you want to start a new game? All achievements will be reset.")) {
                restartGame();
            }
        }

        function restartGame() {
            clickCount = 0;
            freeModeActive = false; // Reset free mode flag
            localStorage.setItem('clickCount', clickCount);
            document.getElementById("clickCount").textContent = clickCount;
            document.getElementById("endScreen").classList.add("hidden");
            document.getElementById("gameScreen").classList.remove("hidden");

            // Hide "Ending" button
            document.getElementById("endButton").classList.add("hidden");
        }

        function resetGame() {
            localStorage.removeItem('gameStarted');
            localStorage.removeItem('clickCount');
            localStorage.removeItem('storyCompleted');
            document.getElementById("gameScreen").classList.add("hidden");
            currentStoryIndex = 0;
            storyCompleted = false;
            showNextStory();
        }

        function showStory() {
            document.getElementById("gameScreen").classList.add("hidden");
            currentStoryIndex = 0;  // Reset index before showing the story
            storyCompleted = false;
            document.getElementById("introScreen").classList.remove("hidden");
            showNextStory();
        }

        document.getElementById('shareButton').addEventListener('click', () => {
            html2canvas(document.body).then(canvas => {
                const link = document.createElement('a');
                link.download = 'mouse_clicker_result.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        });
    </script>
</body>
</html>
